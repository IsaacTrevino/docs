export const meta = {
  title: `Auth events`,
  description: `Listen to various auth events`,
};

AWS Cognito Auth Plugin sends important events through Amplify Hub.

import reactnative0 from "/src/fragments/lib/auth/js/hub_events/10_listen_events.mdx";

<Fragments fragments={{'react-native': reactnative0}} />

import js0 from "/src/fragments/lib/auth/js/hub_events/10_listen_events.mdx";

<Fragments fragments={{js: js0}} />

import ios1 from "/src/fragments/lib/auth/ios/hub_events/10_listen_events.mdx";

<Fragments fragments={{ios: ios1}} />

import android2 from "/src/fragments/lib/auth/android/hub_events/10_listen_events.mdx";

<Fragments fragments={{android: android2}} />

import flutter3 from "/src/fragments/lib/auth/flutter/hub_events/10_listen_events.mdx";

<Fragments fragments={{flutter: flutter3}} />


> *This guide provides essential information to help you select and complete the activities you need for your Amplify project. We organized each section around a distinct job or decision point to help you understand your available options, steps to complete, and recommended best practices. For users who want to learn more, we included extra details and explanations in expandable sections within the guide.*

In this guide, you will learn how to set up Amplify Authentication. This includes setting up and connecting your backend resources, determining your integration path, and enabling sign-up, sign-in, and sign-out. We will also provide more context on how resources are managed and created with Amplify to help you make decisions, and understand any long-term impact of those decisions, for your use case.

## Set up and connect backend resources

Setting up and connecting your backend resources includes understanding how these resources are managed and created to help you choose a management path. We will also look at how your sign in strategy, password formats, and additional authentication methods (e.g. MFA, OTP) may influence some of your choices. 

Before you begin, you will need:
- [Node.js](https://nodejs.org/) v14.x or later
- [npm](https://www.npmjs.com/) v6.14.4 or later
- [git](https://git-scm.com/) v2.14.1 or later

### Decide how to create and manage your backend resources

You can create and manage your Authentication resources with Amplify by using the Amplify CLI, Amplify Studio, or create them outside of Amplify with tools such as CDK and CloudFormation. The most common way is via the Amplify CLI, which allows you to create new Amazon Cognito resources or import existing ones. However, you can also use the Amplify Studio console to configure authentication or use existing resources and directly connect them to your application via the Amplify Libraries.

We recommend using Amplify CLI or Amplify Studio when creating and deploying your Authentication resources (Cognito user pools, IAM roles, etc.) as these tools will help you with resource provisioning, IAM policies and roles for resources, deployments, local testing, continuous integration and deployment (CI/CD), and environment management.

In the Amplify ecosystem, the most common Authentication method is either using Amazon Cognito User Pools independently or with a social provider to validate the identity of the user (known as *Federation*). 

<Accordion title='What is your Auth strategy?' headingLevel='4' eyebrow='Learn more'>

### Title

Amplify helps you secure your application while providing an easy sign-in experience for your users. This experience is influenced by your security strategy. This security strategy includes the authentication method, security credentials, and enabling additional verification when needed.

 - *Authentication* is a process to validate **who you are** (abbreviated as *AuthN*). The system which does this validation is referred to as an Identity Provider or IdP. This can be your own self-hosted IdP or a cloud service. Oftentimes, this IdP is a social provider such as Facebook, Google, or Amazon.
 - *Authorization* is the process of validating **what you can access** (abbreviated as *AuthZ*). This is sometimes done by looking at tokens with custom logic, predefined rules, or signed requests with policies.

Common authentication methods and associated risks include: 
- Username/password which is simple to set up but prone to compromise.
- Social provider federation which enables easier access for your users but shares data with third parties. 
- Multi-factor authentication which adds a layer of security at sign-in but may also add friction for your users.

You can improve security credentials and verification for these authentication methods by: 
- Adding password policies that ensure stronger passwords are created by your users.
- Require additional contact information from users before they can reset passwords.
- Enable One-Time-Passwords for MFA flows to improve user verification.

</Accordion>

<br/>

Amplify uses [Amazon Cognito](https://aws.amazon.com/cognito/) as the main authentication provider. Amazon Cognito is a robust user directory service that handles user registration, authentication, account recovery, and other operations. You will be able to work with Amazon Cognito with each of the management methods. If you have not worked with Amazon Cognito before we recommend taking a closer look at Amazon Cognito configuration decisions before you continue.

<Accordion title='Review Amazon Cognito configuration decisions' headingLevel='4' eyebrow='Learn more'>

## Title2

Amazon Cognito can be customized based on your security strategy for authentication. However, there are some initial configuration options that cannot be changed after the backend resources are configured:

- User attributes that are used to identify your individual users (e.g. username, email, etc.) cannot be renamed or deleted.
- Login methods (including username, email, phone, etc.) cannot be added or changed after the initial configuration. This includes both defining which attributes are used to log-in and which attributes are required. Required attributes must have a value for all users once set.
- Verification methods (including username, email, etc.) are the same as required attributes and cannot be removed once configured.
- The ‘sub’ attribute is a unique identifier within each user pool that cannot be modified and can be used to index and search users.
- If MFA is set to required for all users, you will need to include MFA setup when users sign up.

See the [Amazon Cognito documentation]( https://docs.aws.amazon.com/cognito/latest/developerguide/what-is-amazon-cognito.html) for more details on these settings including [User pool attributes](https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html) and [Adding MFA to a user pool](https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-mfa.html).

</Accordion>

### Set up and configure your Auth category

Once you have chosen your management method you can configure your Auth category and install the library to use with your application.

During this workflow you can set up your password formats. If you have not worked with passwords formats recently we recommend taking a closer look at the best practices before you continue.
 
<Accordion title='Review password best practices' headingLevel='4' eyebrow='Learn more'>

When you are setting up your password formats for authentication you will want to consider the following best practices:

- Password strength: You can set minimum length and specify character types to fortify user passwords.
- Two Factor Authentication: You can enable MFA, or implement One-Time-Passwords to add an extra layer of verification.
- Forgotten passwords: You have the option to require additional verified contact information (e.g. email, phone) or use a validation code in the reset flow.

</Accordion>

#### Set up your Auth backend resources

You can set up your backend resources with the Amplify CLI, Amplify Studio, or use existing resources.

<BlockSwitcher>
<Block name="Amplify CLI (Create)">

> Prerequisites: [Install and configure](/lib/project-setup/prereq/q/platform/js/) the Amplify CLI and have an existing Amplify project or create a new one with `amplify init`

To start provisioning auth resources in the backend, go to your project directory and **execute the command**:

```bash
amplify add auth
```

```console
? Do you want to use the default authentication and security configuration? Default configuration
? How do you want users to be able to sign in? Username
? Do you want to configure advanced settings?  No, I am done.
```

The above prompts will setup a default configuration for you. This includes:
- Username as the sign-in method
- Default password policy
- No MFA enabled
- No 3rd party social providers enabled

If you want to configure advanced settings, you can choose the `Manual configuration` option. The CLI prompts will help you to customize your auth flow for your app. With the provided options, you can:
- Customize sign-in/registration flow
- Customize email and SMS messages for Multi-factor authentication
- Customize attributes for your users (e.g. name, email)
- Enable custom auth flows
- Enable Cognito Lambda triggers
- Enable 3rd party social providers (e.g. Amazon, Facebook, Google and Sign In With Apple)


> If you wish to federate with social providers [you will need to configure them on the provider end first](/lib/auth/social#social-providers-and-federation).


After configuring your Authentication options, update and deploy the backend by running the `push` command:

```bash
amplify push
```

The authentication service will be deployed after a few minutes, then you can start using it. To view the deployed services in your project at any time, go to Amplify Console by running the following command:

```bash
amplify console
```

</Block>

<Block name="Amplify CLI (Import)">

> Prerequisites: [Install and configure](/lib/project-setup/prereq/q/platform/js/) the Amplify CLI and have an existing Amplify project or create a new one with `amplify init`

To import existing Amazon Cognito resources into your Amplify project, **execute the command**:

```bash
amplify import auth
```
```console
? What type of auth resource do you want to import?
   Cognito User Pool and Identity Pool
   Cognito User Pool only
```

Once you've selected an option, you'll be able to search for and import an existing Cognito User Pool and Identity Pool (or User Pool only) within your AWS account and within the region that the Amplify project was created in. The `amplify import auth` command will also do the following:
- Automatically populate your Amplify Library configuration files (`aws-exports.js`) with your chosen Amazon Cognito resource information
- Provide your designated existing Cognito resource as the authentication and authorization mechanism for all auth-dependent categories (API, Storage and more)
- Enable Lambda functions to access the chosen Cognito resource if you permit it

After configuring your Authentication options, update your backend and deploy the service by running the `push` command:

```bash
amplify push
```

Now, the authentication service has been deployed and you can start using it. To view the deployed services in your project at any time, go to Amplify Console by running the following command:

```bash
amplify console
```

</Block>

<Block name="Amplify Studio"> 

> Prerequisites: [Install and configure](/lib/project-setup/prereq/q/platform/js/) the Amplify CLI and have an existing Amplify project or create a new one with `amplify init`

Amplify Studio allows you create auth resources, set up authorization rules, implement Multi-factor authentication (MFA), and more via an intuitive UI. To set up Authentication through the Amplify Studio, take the following steps: 

1. **Sign in** to the [AWS Management Console](https://console.aws.amazon.com/console/home) and open AWS Amplify.
2. In the navigation pane, **choose an application** or create a new one by choosing **New app** and selecting **Build an app**.
- For a new app, enter a name for your app, then choose **Create app**. It will take a few minutes to create the app environment.
- For an existing app, choose the **Backend environments** tab, then choose **Launch Studio** (or **Setup Studio** if you app isn't configured with studio yet) under the environment you are working with.
3. On the **Set up** menu, choose **Authentication**. This will default to **Start from scratch** where new Amazon Cognito resources will be created, however you can use existing resources by choosing **Reuse existing Amazon Cognito resources**.
4. In the **Configure log in** section, choose a login mechanism to add from the **Add login mechanism** list. Valid options are _Username_, _Phone number_, _Facebook_, _Google_, _Amazon_, and _Sign in with Apple_. If you choose one of the social sign-in mechanisms (i.e. _Facebook_, _Google_, _Amazon_, or _Sign in with Apple_), you will also need to enter your _App ID_, _App Secret_, and redirect URLs, as well as configure the provider end to work with Cognito.
5. (Optional) Add Multi-factor authentication (MFA). MFA is set to **Off** by default. To turn on MFA, do the following in the **Multi-factor authentication** section:
- Choose **Enforced** to require MFA for all users or choose **Optional** to allow individual users to enable MFA.
- (Optional) Choose **SMS**, and enter your SMS message.
- (Optional) Choose **Authenticator Application** if you want your app to load with an authentication flow that includes sign up and sign in.
6. In the **Configure sign up** section, expand **Password protection settings** and customize the password policy settings to enforce.
7. Choose **Save and Deploy**. This starts a CloudFormation deployment with the progress displayed in the upper right corner of the page.
8. After creating and configuring your auth resources, you'll need to pull them down from Amplify Studio. To do so, simply click on "Local setup instructions" in the upper right hand corner of the Studio console and execute the CLI command it provides at the root directory of your app. 

> Learn more on how you can [import](https://docs.amplify.aws/console/auth/import/) existing Amazon Cognito resources and [manage users and groups](https://docs.amplify.aws/console/auth/user-management/) through the Amplify Studio UI.

</Block>

<Block name="Existing Resources">

Existing Authentication resources from AWS (e.g. Amazon Cognito UserPools or Identity Pools) can be used with the Amplify Libraries by calling the `Amplify.configure()` method.
 
If you do not have Amplify Libraries, install the necessary dependencies by running the following command:

```sh
npm install aws-amplify
```

In your app's entry point (i.e. **App.js**, **index.js**, **_app.js**, or **main.js**), import and load the configuration file:

```javascript
import { Amplify, Auth } from 'aws-amplify';

Amplify.configure({
  Auth: {
    // REQUIRED only for Federated Authentication - Amazon Cognito Identity Pool ID
    identityPoolId: 'XX-XXXX-X:XXXXXXXX-XXXX-1234-abcd-1234567890ab',

    // REQUIRED - Amazon Cognito Region
    region: 'XX-XXXX-X',

    // OPTIONAL - Amazon Cognito Federated Identity Pool Region
    // Required only if it's different from Amazon Cognito Region
    identityPoolRegion: 'XX-XXXX-X',

    // OPTIONAL - Amazon Cognito User Pool ID
    userPoolId: 'XX-XXXX-X_abcd1234',

    // OPTIONAL - Amazon Cognito Web Client ID (26-char alphanumeric string)
    userPoolWebClientId: 'a1b2c3d4e5f6g7h8i9j0k1l2m3',
  },
});


// You can get the current config object
const currentConfig = Auth.configure();
```

<Callout warning={true}>
If your existing UserPool client has a required attribute that is NOT set to mutable, you may face login issues when using social sign-in. To resolve this, you will need to <ExternalLink href="https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-client-apps.html">create a new UserPool client</ExternalLink> and mark the required attribute as mutable.
</Callout>

</Block>
</BlockSwitcher>

#### Install the Amplify Libraries

Once your backend resources are configured and deployed, you can now install the Amplify Libraries to use with your application by running the following command:

```bash
npm install aws-amplify
```

In your app's entry point (i.e. **App.js**, **index.js**, **_app.js**, or **main.js**), import and load the configuration file:
 
<Callout>

**Note:** If you used the "Existing Resource" tab above, you can skip this step.

</Callout>

```javascript
import { Amplify, Auth } from 'aws-amplify';
import awsconfig from './aws-exports';
Amplify.configure(awsconfig);
```

This will bootstrap your app to use Amplify with the deployed backend resources.
 
**Recap:** You now have set up and configured your backend resources for Amplify authentication and are ready to start working on your front-end application.

## Determine your Auth integration path

Before you implement Auth on your front-end application, you will want to evaluate the options of using the Authenticator UI component, Amplify Libraries methods, or Cognito Hosted UI for your use case. We recommend using Authenticator as the easiest to implement. You can also use Authenticator together with Amplify Libraries methods to extend capabilities when needed. Additionally, the Hosted UI is also best used with the Amplify Libraries because they provide a method to redirect to the Hosted UI.
 
### Compare implementation options

There are a few options to implement Auth depending on how much customization you will need:

|  | Amplify Authenticator | Amplify Libraries | Amplify Hosted UI |
|:--|:--|:--|:--|
| Description | Open source drop-in UI component for authentication | Low-level building blocks for implementing authentication | Pre-built sign-up and sign-in UI components hosted by Cognito outside of your application | 
| Benefits | Automatically integrates with your existing Amplify configuration and allows you to easily add the entire authentication flow to your application. You simply add the component to your app and pass it your Amazon Cognito authentication configuration. You can then customize themes to adjust colors and styling as needed. | Gives you full control over the UI and logic implementation. | Cognito Hosted page with basic customization via properties. | 
| Constraints | Dependent on Amplify CLI for provisioning resources. | Building the UI and managing the authentication state is custom built. | You need to implement logic within your app using the Amplify Libraries. For example calling the endpoint where a user can enter their credentials or checking if the current user is authenticated. |

<br/>
 
**Recap:** We recommend using the Authenticator UI component for quick and easy set up and then use the Amplify Libraries to customize the user experience and logic as needed. Once you decide which option will work for your use case you can continue implementing authentication on your front-end application.

## Enable sign-up, sing-in, sing-out, and verify account

In this section you will set up sign-up, sign-in, and sign-out and then test this functionality. This includes a review of sign-up methods provided by Amplify, the specific user attributes used by Amazon Cognito, how to confirm users after initial sign-up, and the differences between local and global sign-out. This review will help inform your decisions as you add these authentication capabilities using your preferred implementation path - Authenticator, Amplify Libraries, or Hosted UI.

Before you begin, you will need:
- A front-end app
- Set up and connected backend resources with a configured Auth category 
- Decided your authentication implementation path 

Amplify provides two sign-up and sign-in methods to use with your application. 
- The **username/password** method allows your users to sign-up and sign-in to your application using a username (or email) and password of their choosing. It is enabled by default with Cognito User pools. You can customize the sign-up and sign-in templates, specify attribute fields to include, enable verification, etc.
- The **social sign-in** method allows your users to sign-in to your application using OAuth connections to Amazon, Apple, Facebook, Google, and more. This set up will include configuration of the provider name, client ID, and other details.

Additionally, you can enable the Multi-factor authentication (MFA) method which adds an extra layer of security for sign-in. This can be set up with SMS text message or Time-based One-Time Password (TOTP) authentication. Once set up, Amazon Cognito will verify the MFA code entered by your users before authentication succeeds.

For many apps, user sign-up and sign-in with a username/password is all that is required. Once authenticated, the app can talk to an API to access and mutate data. We will use the username/password authentication flow to get started. Both [third party social provider federation]( https://docs.amplify.aws/lib/auth/social/q/platform/js/) and [Multi-factor authentication]( https://docs.amplify.aws/lib/auth/mfa/q/platform/js/) can be added after this initial set up.

<Accordion title='Review the sign-up, sign-in, and sign-out workflow' headingLevel='3' eyebrow='Learn more'>

Below is a high-level overview of the workflows for sign-up, sign-in, and sign-out with Amplify authentication:
 
**Sign-up:** The username/password set up will ask your user for a username (or email) and a password. This should also include any custom attributes you include in your sign-up from such as address, birthdate, phone, etc. When your end-user submits this information, it is then passed through the `Auth.signUp()` method to your Amazon Cognito User Pool, where a user is created. By default, the user will receive a confirmation message via email or SMS, depending on what you configured, but you have the option to configure auto confirmation. They must then enter the confirmation code to complete the sign-up process. Once the user is verified, their user profile is officially confirmed and is active in the Cognito User Pool. The profile contains the username, password, email, and any other custom attributes collected during sign-up. This user profile can then be used to sign-in and access your application.

**Sign-in:** The user enters the username/password they created on sign-up and submits the form in your application to sign-in. The application will then call the `Auth.signIn()` method to sign-in the user by passing the username/password to verify and establish a session with Amazon Cognito which will then generate the needed tokens to grant access. Amazon Cognito issues temporary short-lived tokens on sign-in (default of 1 hour) but you can update these settings to keep your users signed in for longer (up to 24 hours).

**Sign-out:** Amplify uses the `Auth.signOut()` method to sign-out the user by ending the current session and revoking the tokens with Amazon Cognito. This clears the user session in the browser and the application will then navigate the user to the sign-in screen.

## Title BlockSwitcher

<BlockSwitcher>

<Block name="React">

### Title Block

First, install the `@aws-amplify/ui-react` library.

> Note: You will also need to install `aws-amplify` as well if you have not already.

```sh
npm install @aws-amplify/ui-react aws-amplify
```

Next, open __src/App.js__ and add the `Authenticator` component.

**Authenticator**

The `Authenticator` should wrap sections of your app that you want to protect. You will also notice the `user` and `signOut` are provided to the wrapped component.

**Usage**

```jsx
import { Amplify } from 'aws-amplify';

import { Authenticator } from '@aws-amplify/ui-react';
import '@aws-amplify/ui-react/styles.css';

import awsExports from './aws-exports';
Amplify.configure(awsExports);

function App({ signOut, user }) {
  return (
    <Authenticator>
      {({signOut, user}) => (
        <div>
          <h1>Hello, {user.username}</h1>
          <button onClick={signOut}>Sign out</button>
        </div>
      )}
    </Authenticator>
  );
}

export default App;
```
</Block>
<Block name="Vue 3">

First, install the `@aws-amplify/ui-vue` library.

> Note: You will also need to install `aws-amplify` as well if you have not already.

```bash
npm install @aws-amplify/ui-vue aws-amplify
```

Next, open __src/App.js__ and add the `Authenticator` component.

**Authenticator**

The `Authenticator` should wrap sections of your app that you want to protect. You will also notice the `user` and `signOut` are provided to the wrapped component.

```html
<script setup>
  import { Authenticator } from "@aws-amplify/ui-vue";
  import "@aws-amplify/ui-vue/styles.css";

  import { Amplify } from 'aws-amplify';
  import awsconfig from './aws-exports';

  Amplify.configure(awsconfig);
</script>

<template>
  <authenticator>
    <template v-slot="{ user, signOut }">
      <h1>Hello, {{ user.username }}</h1>
      <button @click="signOut">Sign Out</button>
    </template>
  </authenticator>
</template>
```

</Block>
<Block name="Angular">

First, install the `@aws-amplify/ui-angular` library.

> Note: You will also need to install `aws-amplify` as well if you have not already.

```bash
npm install @aws-amplify/ui-angular aws-amplify
```

Now open __app.module.ts__ and add the Amplify imports and configuration:

```js
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { Amplify } from 'aws-amplify';
import { AmplifyAuthenticatorModule } from '@aws-amplify/ui-angular';

import { AppComponent } from './app.component';
import awsconfig from '../aws-exports';

Amplify.configure(awsconfig);

@NgModule({
  declarations: [AppComponent],
  imports: [BrowserModule, AmplifyAuthenticatorModule],
  providers: [],
  bootstrap: [AppComponent],
})
export class AppModule {}
```

Next, import the default theme inside __styles.css__:

```css
@import '~@aws-amplify/ui-angular/theme.css';
````

Next, open __app.component.html__ and add the `amplify-authenticator` component.

**amplify-authenticator**

The `amplify-authenticator` should wrap sections of your app that you want to protect. You will also notice the `user` and `signOut` are provided to the wrapped component.

```html
<amplify-authenticator>
  <ng-template
    amplifySlot="authenticated"
    let-user="user"
    let-signOut="signOut"
  >
    <h1>Hello, {{ user.username }}!</h1>
    <button (click)="signOut()">Sign Out</button>
  </ng-template>
</amplify-authenticator>
```

</Block>
</BlockSwitcher>

</Accordion>

### Decide before you build

Before you enable sign-up, sign-in, and sign-out there are a few decisions you will need to know to complete the process. 

#### Which Amazon Cognito attributes will you pass for sign-up?

User attributes (e.g. username, email, etc.) are used to identify your users. These are set up when you configure your Cognito User Pool and cannot be renamed or deleted after they are configured. You will need to know which attributes were configured as required at set up (e.g. email) and make sure your user is prompted to enter this information. You can find this information in the Amazon Cognito console under the *Sign-up experience* tab. You can also add [additional User Pool attributes]( https://docs.aws.amazon.com/cognito/latest/developerguide/user-pool-settings-attributes.html) that are collected from the sign-up form. This includes attributes like address, birthdate, phone, etc. These attributes are not required by default. You can make these additional attributes required but it cannot be changed back to not required once configured.
 
#### How will you verify users at sign-up?

Once the initial sign-up is done, the user will need to verify and confirm their contact information before their account is activated. This is done by sending a verification code via email or phone number that can be collected on initial sign-up. Email verification asks the user to click a link or enter a code sent to their email address provided during sign-up. Phone verification is done by asking the user to enter the code sent to them in a SMS text message. You can also enable auto-confirmation to skip this step and automatically confirm the user after sign-up. This is accomplished using the PostSignUp Lambda trigger.
 
#### Do you need local or global sign-out?

The default when passing the `Auth.signOut()` method is a local sign out. This will sign-out the user from a specific application or device and revokes the tokens used for authentication in that session. If you need a global sign-out that revokes all associated tokens, credentials, and sessions across all applications and devices, then you update the method to `Auth.signOut({ global: true })`.

### Add the sign-up, sign-in, and sign-out capabilities

There are three ways to add authentication capabilities to your application: Authenticator UI component, Amplify Libraries, or Hosted UI. Select from the options below to complete the steps to set up a simple username/password authentication for your application.
- [Option 1: Use pre-built UI components with Authenticator (recommended)](#option-1-use-pre-built-ui-components-with-authenticator)
- [Option 2: Call Authentication APIs manually with Amplify Libraries](#option-2-call-authentication-apis-manually-with-amplify-libraries)
- [Option 3: Use pre-built Hosted UI with Amazon Cognito](#option-3-use-pre-built-hosted-ui-with-amazon-cognito)

#### Option 1: Use pre-built UI components with Authenticator

Creating the login flow can be quite difficult and time consuming to get right. However, Amplify has authentication UI components you can use that will provide the entire authentication flow for you, using your configuration specified in your __aws-exports.js__ file.

Amplify has pre-built UI components for React, Vue, and Angular (React Native is currently in developer preview).



Once you add the Authenticator component to your app, you can test the sign-up, sign-in, and sign-out functionality. You can also customize the Authenticator UI component to adjust colors and styling as needed.
 
#### Option 2: Call Authentication APIs manually with Amplify Libraries

You can add the library functionality to enable sign-up, sign-in, and sign-out directly with the Amplify Libraries. You can connect this to an existing UI or create your own.

<BlockSwitcher>
<Block name="Amplify Library Sign-up">

Create a new user in the Amazon Cognito User Pool by passing the new user's email address, password, and other attributes to `Auth.signUp()`.

```javascript
import { Auth } from 'aws-amplify';

async function signUp() {
  try {
    const user = await Auth.signUp({
      username,
      password,
      attributes: {
        email,          // optional
        phone_number,   // optional - E.164 number convention
        // other custom attributes 
      },
      autoSignIn: { // optional - enables auto sign in after user is confirmed, defaults to false
        enabled: true,
      }
    });
    console.log(user);
  } catch (error) {
    console.log('error signing up:', error);
  }
}
```

##### Confirm sign up

By default, each user that signs up remains in the unconfirmed status until they verify with a confirmation code that was sent to their email or phone number. You can confirm the sign-up after retrieving a confirmation code from the user as shown here.

```js
import { Auth } from 'aws-amplify';

async function confirmSignUp() {
  try {
    await Auth.confirmSignUp(username, code);
  } catch (error) {
    console.log('error confirming sign up', error);
  }
}
```

As part of the options parameter, you can specify the `forceAliasCreation` boolean. This is set to `true` by default. If set to `false` and the email or phone number used for sign-up confirmation already exists as an alias for a different user, the API will throw an `AliasExistsException` error. If set to `true`, the API call will migrate the alias from the previous user to a newly created user.

```js
import { Auth } from 'aws-amplify';

async function confirmSignUp() {
  try {
    await Auth.confirmSignUp(username, code, { forceAliasCreation: false });
  } catch (error) {
    console.log('error confirming sign up', error);
  }
}
```

</Block>
<Block name="Amplify Library Sign-in">

You pass the username and password to the `signIn` method of the Auth class to enable username and password sign-in.

```javascript
import { Auth } from 'aws-amplify';

async function signIn() {
  try {
    const user = await Auth.signIn(username, password);
  } catch (error) {
    console.log('error signing in', error);
  }
}
```

</Block>
<Block name="Amplify Library Sign-out">

To set up local sign-out you use the `signOut` method of the Auth class.

```javascript
import { Auth } from 'aws-amplify';

async function signOut() {
  try {
    await Auth.signOut();
  } catch (error) {
    console.log('error signing out: ', error);
  }
}
```

You can sign out users from all devices by adding global sign-out. It also invalidates all refresh tokens issued to an user. The user's current access and Id tokens remain valid until they expire (access and Id tokens expire one hour after they are issued).
 
```js
import { Auth } from 'aws-amplify';

async function signOut() {
  try {
    await Auth.signOut({ global: true });
  } catch (error) {
    console.log('error signing out: ', error);
  }
}
``` 

</Block>
</BlockSwitcher>

Once you implement the Amplify Library methods within your application, you can test the sign-up, sign-in, and sign-out functionality.

#### Option 3: Use pre-built Hosted UI with Amazon Cognito

The [Cognito Hosted UI]( https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-integration.html#cognito-user-pools-create-an-app-integration) can be set up directly in the console under your Cognito User Pool settings. The default pre-built UI provides you with sign-up and sign-in URLs that can be generated for you automatically by calling `Auth.federatedSignIn()`. You will link your application to these URLs to enable your users to sign-up or sign-in directly with Cognito. Once they are authenticated they will be redirected back to your application with an authorization code in the URL, which will be used by Amplify in exchange for tokens. There is not a built-in sign-out experience for this UI but you can use `Auth.signOut()` as well. You can learn more about [configuring the Hosted UI]( https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-idp-settings.html) in the Amazon Cognito documentation.

### View the created user in the AWS Console

After you test the sign-up, sign-in, and sign-out functionality, you can take a look at the created user in the Amazon Cognito console. To do so, you can use `amplify console auth` to open the console directly from the CLI, or take a look at the existing User Pools in the console. Note the users status should be "CONFIRMED" if you successfully verified the user; however, it can be in "unconfirmed" if the user is not yet verified. You can also check to make sure any other required attributes are updating correctly.

**Recap:** You now have enabled sign-up, sign-in, and sign-out for your authentication and verified its functionality with a test user.
 
## Conclusion

Congratulations! You finished the **Set up Amplify Auth** guide. In this guide, you set up and connected to backend resources, compared and determined your Auth integration path, and enabled sign-up, sign-in, and sign-out while verifying they function as expected.

## Next steps

TBD - Potentially a link to Social Sign In and MFA setup.
 